<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Competition Mode - Box Break Simulator</title>
  <link rel="stylesheet" href="styles.css?v=20260122b">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚔️</text></svg>">
  <style>
    /* Competition Mode Layout */
    body {
      padding: var(--space-md);
    }

    .competition-wrapper {
      max-width: 900px;
      margin: 0 auto;
    }

    /* Header - same as main but smaller */
    .header {
      padding: var(--space-sm) 0;
      margin-bottom: var(--space-md);
    }

    /* Main grid: Info left, Card/Pack right */
    .competition-main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-lg);
      align-items: start;
      margin-bottom: var(--space-lg);
    }

    .competition-info {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .competition-set-box {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
    }

    .competition-set-box .set-name {
      font-family: 'Cinzel', serif;
      font-size: 1.25rem;
      color: var(--color-gold);
      margin-bottom: var(--space-sm);
    }

    .competition-set-box .set-details {
      font-size: 0.85rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* Right side: Card/Pack area - no border, just aligned */
    .competition-reveal-area {
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .competition-pack-area {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Pack sizing */
    .competition-pack-area .booster-pack {
      width: 180px;
      height: 252px;
    }

    /* Hide elements we don't need in competition mode */
    .mtg-frame,
    .pokemon-frame,
    .controls,
    #starterContainer,
    #pokemonPackContainer,
    #pokemonBoxContainer,
    #pokemonRevealContainer,
    #boxResultsContainer,
    .site-footer {
      display: none !important;
    }

    /* Reveal container */
    .competition-reveal-area #revealContainer {
      display: none;
      flex-direction: column;
      align-items: center;
    }

    .competition-reveal-area #revealContainer[style*="flex"] {
      display: flex !important;
    }

    #revealContainer .main-card-area {
      width: 180px;
      height: 252px;
    }

    #revealContainer .main-card-area img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: var(--radius-lg);
    }

    #revealContainer .card-info {
      text-align: center;
      margin-top: var(--space-sm);
      font-size: 0.85rem;
    }

    /* Stable hint display */
    #competitionHint {
      min-height: 1.5em;
    }

    /* Hide pack value in reveal area - shown above mini cards instead */
    #revealContainer .pack-value,
    #revealContainer #packValue {
      display: none !important;
    }

    /* Show individual card value */
    #revealContainer #cardValue {
      display: block !important;
      color: #4ade80;
      font-weight: 600;
    }

    /* Hide rarity labels in competition mode */
    #revealContainer .rarity-label,
    .rarity-label {
      display: none !important;
    }

    /* Pack Value header above mini cards */
    .pack-value-header {
      text-align: center;
      font-family: 'Cinzel', serif;
      font-size: 1rem;
      color: var(--color-gold);
      margin-top: var(--space-lg);
      margin-bottom: var(--space-sm);
    }

    .pack-value-header span {
      color: #4ade80;
      font-weight: 600;
    }

    /* Revealed row styling - below the main grid */
    .competition-wrapper > .revealed-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: var(--space-sm);
      margin-top: var(--space-md);
      padding: var(--space-md);
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      min-height: 90px;
    }

    .revealed-row .mini-card {
      width: 55px;
      height: 77px;
      cursor: pointer;
    }

    /* Disable the zoom-on-hover for competition mode - we show in main area instead */
    .revealed-row .mini-card:hover {
      transform: none !important;
      z-index: auto !important;
    }

    /* Highlight the hovered card */
    .revealed-row .mini-card:hover {
      box-shadow: 0 0 15px var(--color-gold-glow);
    }

    /* Collection below fold */
    #mtgCollection,
    #pokemonCollectionSection {
      margin-top: var(--space-xl);
    }

    /* Competition Open button */
    .competition-open-btn {
      padding: var(--space-md) var(--space-xl);
      font-size: 1.1rem;
      background: linear-gradient(135deg, var(--color-gold), var(--color-gold-dark));
      color: #000;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-family: 'Cinzel', serif;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .competition-open-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px var(--color-gold-glow);
    }

    /* Mode switch link */
    .mode-link {
      text-align: center;
      margin-top: var(--space-xl);
      padding: var(--space-md);
      border-top: 1px solid var(--border-subtle);
    }

    .mode-link a {
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.85rem;
    }

    .mode-link a:hover {
      color: var(--color-gold);
    }

    /* Responsive */
    @media (max-width: 640px) {
      .competition-main {
        grid-template-columns: 1fr;
        gap: var(--space-md);
      }

      .competition-pack-area {
        order: -1;
      }

      .competition-pack-area .booster-pack {
        width: 160px;
        height: 224px;
      }

      .revealed-row .mini-card {
        width: 45px;
        height: 63px;
      }
    }
  </style>
</head>
<body>
  <div class="competition-wrapper">

    <!-- Header -->
    <div class="header" id="gameHeader">
      <img src="mtg-logo.png" alt="Magic: The Gathering" class="header-logo" id="gameLogo" onclick="toggleGameMode()" title="Click to switch game mode">
      <h1 class="subtitle">BOX BREAK SIMULATOR</h1>
    </div>

    <!-- Competition Main Area -->
    <div class="competition-main">
      <!-- Left: Set Info & Open Button -->
      <div class="competition-info">
        <div class="competition-set-box">
          <div class="set-name" id="competitionSetName">Alpha Booster Pack</div>
          <div class="set-details" id="competitionSetDetails">Premiering in August 1993 as the first Magic: The Gathering set, Limited Edition Alpha was the set that started it all. It had 295 cards and a mere 2.6 million print run. The revised, black-bordered, 302-card Limited Edition Beta set sold out quickly later that year, immediately followed by the Unlimited Edition white-bordered set of the same 302 cards.</div>
        </div>
        <button class="competition-open-btn" id="competitionOpenBtn">Open Pack</button>
      </div>

      <!-- Right: Pack Display & Card Reveal wrapper -->
      <div class="competition-reveal-area">
        <!-- Pack -->
        <div class="competition-pack-area" id="packContainer">
          <div class="booster-pack" id="boosterPack" onclick="competitionOpenPack()">
            <div class="pack-glow"></div>
            <img src="booster-pack-art.png" alt="Booster Pack" id="packImage">
          </div>
        </div>

        <!-- Card reveal area (same position as pack) -->
        <div class="reveal-container" id="revealContainer" style="display:none;">
          <div class="rarity-label" id="rarityLabel" style="display:none;"></div>
          <div class="main-card-area" id="mainCardArea" onclick="handleCardClick()"></div>
          <div class="card-info">
            <div class="card-counter" style="display:none;">Card <span id="currentCard">0</span> of <span id="totalCards">15</span></div>
            <div class="card-value" id="cardValue" style="display:none;"></div>
            <!-- Pack value hidden here, shown in header above mini cards -->
            <div id="packValue" style="display:none !important;"><span id="packValueAmount">$0</span></div>
            <div class="card-hint" id="cardHint" style="display:none;"></div>
            <div class="card-hint" id="competitionHint"><span id="hintText">0 of 15</span> · Tap for next card</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Hidden MTG Frame (needed for game-logic.js) -->
    <div class="mtg-frame" id="mtgFrame" style="display:none;">
      <div class="set-buttons">
        <button class="mtg-btn active" data-set="lea">Alpha</button>
      </div>
      <p class="set-info" id="setInfo"></p>
      <div class="product-buttons">
        <button class="mtg-btn active" id="boosterBtn">Booster</button>
        <button class="mtg-btn extra-option" id="boosterBoxBtn" style="display:none;">Box</button>
        <button class="mtg-btn extra-option" id="starterBtn" style="display:none;">Starter</button>
        <button class="mtg-btn extra-option" id="starterBoxBtn" style="display:none;">Starter Box</button>
      </div>
      <p class="product-info" id="productInfo"></p>
    </div>

    <!-- Hidden Pokemon Frame -->
    <div class="pokemon-frame" id="pokemonFrame" style="display:none;">
      <div class="set-buttons"></div>
      <div class="product-buttons">
        <button class="mtg-btn" id="pokemonBoosterBtn">Booster</button>
        <button class="mtg-btn extra-option" id="pokemonBoxBtn" style="display:none;">Box</button>
      </div>
    </div>

    <!-- Hidden controls (needed for game-logic.js) -->
    <div class="controls" style="display:none;">
      <button id="openBtn">Open Pack</button>
      <button id="skipBtn" class="secondary" disabled>Open All</button>
    </div>

    <!-- Alert -->
    <div id="alert" class="alert"></div>

    <!-- Screen flashes -->
    <div class="power9-flash" id="power9Flash"></div>
    <div class="chase-flash" id="chaseFlash"></div>

    <!-- Starter Container (hidden, needed for JS) -->
    <div class="reveal-container" id="starterContainer" style="display:none;">
      <div class="starter-deck" id="starterDeck"></div>
    </div>

    <!-- Pack Value heading above mini cards -->
    <div class="pack-value-header" id="packValueHeader" style="display:none;">
      Pack Value: <span id="packValueDisplay">$0</span>
    </div>

    <!-- Revealed row (below the main grid) -->
    <div class="revealed-row" id="revealedRow"></div>

    <!-- Pokemon containers (hidden) -->
    <div id="pokemonPackContainer" style="display:none;"></div>
    <div id="pokemonBoxContainer" style="display:none;"></div>
    <div id="pokemonRevealContainer" style="display:none;">
      <div id="pokemonRarityLabel"></div>
      <div id="pokemonMainCardArea"></div>
      <div id="pokemonCurrentCard"></div>
      <div id="pokemonTotalCards"></div>
      <div id="pokemonCardValue"></div>
      <div id="pokemonPackValue"></div>
      <div id="pokemonPackValueAmount"></div>
      <div id="pokemonCardHint"></div>
      <div id="pokemonRevealedRow"></div>
    </div>

    <!-- Box Results (hidden) -->
    <div id="boxResultsContainer" class="box-results-container" style="display:none;">
      <h2 id="boxResultsTitle"></h2>
      <div id="boxStats"></div>
      <div id="boxPower9Section" style="display:none;"><div id="boxPower9Area"></div></div>
      <div id="boxDualSection" style="display:none;"><div id="boxDualArea"></div></div>
      <div id="boxRaresSection"><div id="boxRaresArea"></div></div>
    </div>

    <!-- MTG Collection -->
    <div class="collection" id="mtgCollection" style="display:none;">
      <h2>Collection (<span id="collCount">0</span> unique cards)</h2>
      <div class="collection-value" id="collectionValue">Total Value: <span id="collectionValueAmount">$0</span></div>

      <div id="power9Section" class="collection-section power9-section" style="display:none;">
        <h3 class="section-title power9-title">Power Nine</h3>
        <div id="power9Area" class="collection-area power9-area"></div>
      </div>

      <div id="dualSection" class="collection-section dual-section" style="display:none;">
        <h3 class="section-title dual-title">Dual Lands</h3>
        <div id="dualArea" class="collection-area dual-area"></div>
      </div>

      <div id="colorSections" class="color-sections">
        <div id="whiteSection" class="collection-section color-section" style="display:none;">
          <h3 class="section-title white-title">White</h3>
          <div id="whiteArea" class="collection-area"></div>
        </div>
        <div id="blueSection" class="collection-section color-section" style="display:none;">
          <h3 class="section-title blue-title">Blue</h3>
          <div id="blueArea" class="collection-area"></div>
        </div>
        <div id="blackSection" class="collection-section color-section" style="display:none;">
          <h3 class="section-title black-title">Black</h3>
          <div id="blackArea" class="collection-area"></div>
        </div>
        <div id="redSection" class="collection-section color-section" style="display:none;">
          <h3 class="section-title red-title">Red</h3>
          <div id="redArea" class="collection-area"></div>
        </div>
        <div id="greenSection" class="collection-section color-section" style="display:none;">
          <h3 class="section-title green-title">Green</h3>
          <div id="greenArea" class="collection-area"></div>
        </div>
        <div id="colorlessSection" class="collection-section color-section" style="display:none;">
          <h3 class="section-title colorless-title">Artifacts</h3>
          <div id="colorlessArea" class="collection-area"></div>
        </div>
      </div>

      <div id="emptyCollection" class="empty">Open packs to start your collection!</div>
    </div>

    <!-- Pokemon Collection (hidden) -->
    <div class="collection pokemon-collection" id="pokemonCollectionSection" style="display:none;">
      <h2>Collection (<span id="pokemonCollCount">0</span> unique cards)</h2>
      <div class="collection-value" id="pokemonCollectionValue">Total Value: <span id="pokemonCollectionValueAmount">$0</span></div>
      <div id="chaseSection" style="display:none;"><div id="chaseArea"></div></div>
      <div id="holoSection" style="display:none;"><div id="holoArea"></div></div>
      <div id="pokemonTypeSections">
        <div id="fireSection" style="display:none;"><div id="fireArea"></div></div>
        <div id="waterSection" style="display:none;"><div id="waterArea"></div></div>
        <div id="grassSection" style="display:none;"><div id="grassArea"></div></div>
        <div id="lightningSection" style="display:none;"><div id="lightningArea"></div></div>
        <div id="psychicSection" style="display:none;"><div id="psychicArea"></div></div>
        <div id="fightingSection" style="display:none;"><div id="fightingArea"></div></div>
        <div id="colorlessPokeSection" style="display:none;"><div id="colorlessPokeArea"></div></div>
        <div id="trainerSection" style="display:none;"><div id="trainerArea"></div></div>
        <div id="energySection" style="display:none;"><div id="energyArea"></div></div>
      </div>
      <div id="pokemonEmptyCollection" class="empty"></div>
    </div>

    <!-- Mode switch -->
    <div class="mode-link">
      <a href="index.html">Switch to Full Mode</a>
    </div>

  </div>

  <!-- Scripts -->
  <script src="card-data.js"></script>
  <script src="atq-data.js"></script>
  <script src="price-data.js?v=20260122"></script>
  <script src="game-logic.js?v=20260122f"></script>
  <script src="pokemon-data.js?v=20260122d"></script>
  <script src="pokemon-mode.js?v=20260122g"></script>

  <script>
    // Competition mode: Use original game logic but add hover-to-view on revealed cards

    function competitionOpenPack() {
      // Reset pack complete flag
      packComplete = false;
      // Trigger original pack opening (generates the pack)
      document.getElementById('openBtn').click();
      // Then open the booster pack animation/reveal
      setTimeout(function() {
        openBoosterPack();
        updateCardHint();
        // Show pack value header
        document.getElementById('packValueHeader').style.display = 'block';
        // Start syncing pack value
        startPackValueSync();
      }, 100);
    }

    // Sync pack value display with the one game-logic.js updates
    let packValueSyncInterval;
    function startPackValueSync() {
      // Clear any existing interval
      if (packValueSyncInterval) clearInterval(packValueSyncInterval);

      packValueSyncInterval = setInterval(function() {
        const original = document.getElementById('packValueAmount');
        const display = document.getElementById('packValueDisplay');
        if (original && display) {
          display.textContent = original.textContent;
        }
      }, 100);
    }

    document.getElementById('competitionOpenBtn').onclick = competitionOpenPack;

    // Track if pack is complete to prevent main card from changing
    let packComplete = false;
    let lastCardHtml = '';

    // Add click listener to mainCardArea for our extra functionality
    document.getElementById('mainCardArea').addEventListener('click', function() {
      // Save current card HTML BEFORE game-logic.js processes the click
      const mainArea = document.getElementById('mainCardArea');
      if (mainArea.innerHTML && !mainArea.innerHTML.includes('card-back')) {
        lastCardHtml = mainArea.innerHTML;
      }

      // After a short delay (let original handler run first), add hover listeners and update hint
      setTimeout(function() {
        addHoverListeners();
        updateCardHint();

        // Check if we need to restore the last card (game-logic.js may have shown card back)
        if (packComplete && lastCardHtml) {
          const currentContent = document.getElementById('mainCardArea').innerHTML;
          if (!currentContent || currentContent.includes('card-back')) {
            document.getElementById('mainCardArea').innerHTML = lastCardHtml;
          }
        }
      }, 150);
    });

    // Watch for the main card area being cleared after pack complete
    const mainCardObserver = new MutationObserver(function(mutations) {
      if (packComplete && lastCardHtml) {
        const mainArea = document.getElementById('mainCardArea');
        // If the card area was cleared or shows card back, restore last card
        if (!mainArea.innerHTML || mainArea.innerHTML.includes('card-back')) {
          mainArea.innerHTML = lastCardHtml;
        }
      }
    });

    // Start observing after a delay to let page load
    setTimeout(function() {
      const mainArea = document.getElementById('mainCardArea');
      if (mainArea) {
        mainCardObserver.observe(mainArea, { childList: true, subtree: true });
      }
    }, 500);

    // Update card hint - uses our own element that game-logic.js doesn't touch
    function updateCardHint() {
      const currentEl = document.getElementById('currentCard');
      const totalEl = document.getElementById('totalCards');
      const hintText = document.getElementById('hintText');

      if (!hintText) return;

      const current = parseInt(currentEl?.textContent) || 0;
      const total = parseInt(totalEl?.textContent) || 15;
      const remaining = total - current;

      if (remaining <= 0) {
        hintText.textContent = 'Pack complete!';
        // Change the trailing text
        hintText.nextSibling.textContent = ' Hover to view cards';
        packComplete = true;
      } else if (remaining <= 3) {
        hintText.textContent = remaining + ' left';
      } else {
        hintText.textContent = current + ' of ' + total;
      }
    }

    function addHoverListeners() {
      const miniCards = document.querySelectorAll('#revealedRow .mini-card');
      miniCards.forEach((mini, index) => {
        // Only add if not already added
        if (!mini.dataset.hoverAdded) {
          mini.dataset.hoverAdded = 'true';
          mini.addEventListener('mouseenter', function() {
            showHoveredCard(mini, index);
          });
        }
      });
    }

    // Competition mode toggle - handle it ourselves
    let competitionGameMode = 'mtg';

    document.getElementById('gameLogo').onclick = function() {
      competitionGameMode = competitionGameMode === 'mtg' ? 'pokemon' : 'mtg';
      updateCompetitionDisplay();
    };

    function updateCompetitionDisplay() {
      const setName = document.getElementById('competitionSetName');
      const setDetails = document.getElementById('competitionSetDetails');
      const packImage = document.getElementById('packImage');
      const logo = document.getElementById('gameLogo');

      if (competitionGameMode === 'mtg') {
        setName.textContent = 'Alpha Booster Pack';
        setDetails.textContent = 'Premiering in August 1993 as the first Magic: The Gathering set, Limited Edition Alpha was the set that started it all. It had 295 cards and a mere 2.6 million print run. The revised, black-bordered, 302-card Limited Edition Beta set sold out quickly later that year, immediately followed by the Unlimited Edition white-bordered set of the same 302 cards.';
        packImage.src = 'booster-pack-art.png';
        logo.src = 'mtg-logo.png';
        // Set for game logic
        if (typeof currentSetCode !== 'undefined') currentSetCode = 'lea';
        if (typeof gameMode !== 'undefined') gameMode = 'mtg';
      } else {
        setName.textContent = '1st Edition Booster Pack';
        setDetails.textContent = 'Released in January 1999, the Base Set was the first English Pokemon TCG set. The 1st Edition print run was extremely limited, making these cards highly sought after by collectors worldwide.';
        packImage.src = 'pokemon-pack-charizard.jpg';
        logo.src = 'pokemon-logo.png';
        // Set for game logic
        if (typeof currentSetCode !== 'undefined') currentSetCode = 'base1';
        if (typeof gameMode !== 'undefined') gameMode = 'pokemon';
      }

      // Reset pack display
      document.getElementById('packContainer').style.display = 'flex';
      document.getElementById('revealContainer').style.display = 'none';
      document.getElementById('revealedRow').innerHTML = '';
    }

    function showHoveredCard(miniElement, index) {
      const mainArea = document.getElementById('mainCardArea');
      const img = miniElement.querySelector('img');
      if (!img) return;

      // Clone the image to main area
      mainArea.innerHTML = '';
      const newImg = document.createElement('img');
      newImg.src = img.src;
      newImg.alt = img.alt;
      newImg.style.width = '100%';
      newImg.style.height = '100%';
      newImg.style.objectFit = 'cover';
      newImg.style.borderRadius = 'var(--radius-lg)';
      mainArea.appendChild(newImg);

      // Update card counter
      document.getElementById('currentCard').textContent = index + 1;

      // Show price from the mini card's data attributes
      const price = miniElement.dataset.price;
      const priceFormatted = miniElement.dataset.priceFormatted;
      const cardValue = document.getElementById('cardValue');
      if (cardValue && priceFormatted) {
        cardValue.innerHTML = priceFormatted;
        cardValue.style.display = 'block';
      }

      // Update rarity label based on mini card classes
      const rarityLabel = document.getElementById('rarityLabel');
      if (miniElement.classList.contains('power-nine')) {
        rarityLabel.textContent = 'POWER NINE!';
        rarityLabel.style.display = 'block';
        rarityLabel.className = 'rarity-label rarity-rare';
      } else if (miniElement.classList.contains('rarity-rare')) {
        rarityLabel.textContent = 'RARE';
        rarityLabel.style.display = 'block';
        rarityLabel.className = 'rarity-label rarity-rare';
      } else {
        rarityLabel.style.display = 'none';
      }
    }

    // Update competition info when game mode changes
    const originalToggleGameMode = window.toggleGameMode;
    window.toggleGameMode = function() {
      if (originalToggleGameMode) originalToggleGameMode();
      updateCompetitionInfo();
    };

    function updateCompetitionInfo() {
      const isMtg = window.gameMode === 'mtg';
      const setName = document.getElementById('competitionSetName');
      const setDetails = document.getElementById('competitionSetDetails');
      const packImage = document.getElementById('packImage');
      const logo = document.getElementById('gameLogo');

      if (isMtg) {
        setName.textContent = 'Alpha Booster Pack';
        setDetails.textContent = 'Premiering in August 1993 as the first Magic: The Gathering set, Limited Edition Alpha was the set that started it all. It had 295 cards and a mere 2.6 million print run. The revised, black-bordered, 302-card Limited Edition Beta set sold out quickly later that year, immediately followed by the Unlimited Edition white-bordered set of the same 302 cards.';
        packImage.src = 'booster-pack-art.png';
        logo.src = 'mtg-logo.png';
      } else {
        setName.textContent = '1st Edition Booster Pack';
        setDetails.textContent = 'Released in January 1999, the Base Set was the first English Pokemon TCG set. The 1st Edition print run was extremely limited, making these cards highly sought after by collectors worldwide.';
        packImage.src = 'pokemon-pack-charizard.jpg';
        logo.src = 'pokemon-logo.png';
      }
    }
  </script>
</body>
</html>
